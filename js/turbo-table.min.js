class TurboTable{constructor(t,{url:e,headers:r={}},{initialSort:a={},pagination:i=!0,params:n=null}){this.containerId=t,this.attrGetFunc=n,this.sort=a,this.apiUrl=e,this.apiHeaders=r,this.pagination=i,this.init()}reload(){this.renderData()}listen(t=null){this.renderDataFunc=t,this.renderData()}appendRow(t=null){this.appendRowFunc=t,this.renderData()}init(){["change","click","keyup","keydown"].forEach(t=>{for(var e=document.querySelectorAll(`#${this.containerId} [turbo\\:render\\.${t}]`),r=0;r<e.length;r++)e[r].removeEventListener(t,this.elementHandleRender.bind(this)),e[r].addEventListener(t,this.elementHandleRender.bind(this))});for(var t=document.querySelectorAll(`#${this.containerId} [turbo\\:pagination\\.click`),e=0;e<t.length;e++)t[e].removeEventListener("click",this.elementHandlePagination.bind(this)),t[e].addEventListener("click",this.elementHandlePagination.bind(this));for(var r=document.querySelectorAll(`#${this.containerId} [turbo\\:sort`),e=0;e<r.length;e++){r[e].classList.add("sorting");let{sort_by:a,sort_dir:i}=this.sort;var n=r[e].getAttribute("turbo:sort");a&&a===n&&r[e].classList.add(`sorting_${i}`),r[e].removeEventListener("click",this.elementHandleSort.bind(this)),r[e].addEventListener("click",this.elementHandleSort.bind(this))}}elementHandleRender(t){var e=t.target.getAttribute(`turbo:render.${t.type}`)||0;clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{let t=document.querySelector(`#${this.containerId}-trubo-page`);t&&(t.value=1),this.renderData()},e)}elementHandlePagination(t){var e=t.target.getAttribute("turbo:pagination.action")||0;clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.renderData()},e)}elementHandleSort(t){clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{var e=t.target.getAttribute("turbo:sort");if(e){var r=document.querySelectorAll(`#${this.containerId} .sorting`);for(let a=0;a<r.length;a++){let i=r[a];i.classList.remove("sorting_asc"),i.classList.remove("sorting_desc")}let{sort_by:n,sort_dir:s}=this.sort;n&&n===e?this.sort.sort_dir="asc"===s?"desc":"asc":this.sort={sort_by:e,sort_dir:"asc"},t.target.classList.add(`sorting_${this.sort.sort_dir}`),this.renderData()}},0)}renderData(){this.params=this.attrGetFunc?this.attrGetFunc():{};let t=document.querySelector(`#${this.containerId}-trubo-page`),e={page:t?t.value:1},r=new URLSearchParams({...this.params,...this.sort,...e}).toString(),a=`${this.apiUrl}${this.apiUrl.includes("?")?"&":"?"}${r}`,i=new XMLHttpRequest;for(let n in i.open("GET",a,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.apiHeaders)i.setRequestHeader(n,this.apiHeaders[n]);i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE&&200===i.status){let t=JSON.parse(i.responseText);if(t?.data){if(this.pagination){var e=document.querySelector(`#${this.containerId} [turbo\\:info\\.count`);e&&(e.innerText=t.data?.total||0);var r=document.querySelector(`#${this.containerId} [turbo\\:info\\.records`);r&&(r.innerText="",t.data?.from!=null&&(r.innerText=`Records: ${t.data?.from} - ${t.data?.to} of ${t.data?.total}`));var a=document.querySelector(`#${this.containerId} [turbo\\:pagination`);a&&(a.innerHTML="",t.data?.from!=null&&t.data?.from!=t.data?.last_page&&(a.appendChild(this.paginationContainerCreator(t.data)),this.init()))}var n=t.data?.data||[];if(this.renderDataFunc&&this.renderDataFunc(n),this.appendRowFunc){var s=document.querySelector(`#${this.containerId} table tbody`);s.innerHTML="",n.forEach(t=>{s.insertAdjacentHTML("beforeend",this.appendRowFunc(t))})}}}},i.send()}paginationContainerCreator(t){var e=t;let r=this.containerId,a=document.createElement("ul");a.className="turbo-pagination pagination";let i=document.createElement("input");if(i.type="hidden",i.value=e.current_page,i.id=`${r}-trubo-page`,a.appendChild(i),1!=e.current_page){let n=document.createElement("li"),s=document.createElement("button");s.className="btn bg-white shadow-sm btn-hover mx-1",s.classList.add("next");let l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),l.setAttribute("fill","#000000"),l.setAttribute("version","1.1"),l.setAttribute("id","Capa_1"),l.setAttribute("viewBox","0 0 30.725 30.725"),l.setAttribute("xml:space","preserve"),l.setAttribute("height","12px");let o=document.createElementNS("http://www.w3.org/2000/svg","g"),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d","M24.078,26.457c0.977,0.978,0.977,2.559,0,3.536c-0.488,0.488-1.128,0.731-1.77,0.731c-0.639,0-1.278-0.243-1.768-0.731   L5.914,15.362l14.629-14.63c0.977-0.977,2.559-0.976,3.535,0c0.977,0.977,0.977,2.56,0,3.536L12.984,15.362L24.078,26.457z"),o.appendChild(d),l.appendChild(o),s.appendChild(l),s.onclick=function(){let t=document.querySelector(`#${r}-trubo-page`);t.value=e.current_page-1},s.setAttribute("turbo:pagination.click","100"),n.appendChild(s),a.appendChild(n)}if(e.current_page>3){let c=document.createElement("li");c.className="hidden-xs";let p=document.createElement("button");p.className="btn bg-white shadow-sm btn-hover",p.innerHTML="1",p.onclick=function(){let t=document.querySelector(`#${r}-trubo-page`);t.value=1},p.setAttribute("turbo:pagination.click","100"),c.appendChild(p),a.appendChild(c)}if(e.current_page>4){let u=document.createElement("li"),h=document.createElement("span");h.className="font-120 mx-2",h.innerHTML="...",u.appendChild(h),a.appendChild(u)}if(((t,e)=>{let r=[];for(let a=1;a<=e;a++)r.push(a);return r})(1,e.last_page).forEach(t=>{if(t>=e.current_page-1&&t<=e.current_page+2){let i=document.createElement("li"),n=document.createElement("button");n.className="btn bg-white shadow-sm btn-hover mx-1",t===e.current_page?(n.classList.add("active"),n.textContent=t):(n.textContent=t,n.onclick=function(){let e=document.querySelector(`#${r}-trubo-page`);e.value=t},n.setAttribute("turbo:pagination.click","100")),i.appendChild(n),a.appendChild(i)}}),e.current_page<e.last_page-3){let $=document.createElement("li"),g=document.createElement("span");g.className="fw-bold font-120 mx-2",g.textContent="...",$.appendChild(g),a.appendChild($)}if(e.current_page<e.last_page-2){let b=document.createElement("li");b.className="hidden-xs";let m=document.createElement("button");m.className="btn bg-white shadow-sm btn-hover mx-1",m.textContent=e.last_page,m.onclick=function(){let t=document.querySelector(`#${r}-trubo-page`);t.value=e.last_page},m.setAttribute("turbo:pagination.click","100"),b.appendChild(m),a.appendChild(b)}if(e.current_page!==e.last_page){let w=document.createElement("li"),_=document.createElement("button");_.className="btn bg-white shadow-sm btn-hover mx-1",_.onclick=function(){let t=document.querySelector(`#${r}-trubo-page`);t.value=e.current_page+1},_.setAttribute("turbo:pagination.click","100"),_.classList.add("next");let v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttribute("fill","#000000"),v.setAttribute("version","1.1"),v.setAttribute("id","Capa_1"),v.setAttribute("xmlns","http://www.w3.org/2000/svg"),v.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),v.setAttribute("viewBox","0 0 30.725 30.725"),v.setAttribute("xml:space","preserve"),v.setAttribute("transform","matrix(-1, 0, 0, 1, 0, 0)"),v.setAttribute("height","12px");let f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("id","SVGRepo_bgCarrier"),f.setAttribute("stroke-width","0");let A=document.createElementNS("http://www.w3.org/2000/svg","g");A.setAttribute("id","SVGRepo_tracerCarrier"),A.setAttribute("stroke-linecap","round"),A.setAttribute("stroke-linejoin","round");let C=document.createElementNS("http://www.w3.org/2000/svg","g");C.setAttribute("id","SVGRepo_iconCarrier");let E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d","M24.078,26.457c0.977,0.978,0.977,2.559,0,3.536c-0.488,0.488-1.128,0.731-1.77,0.731c-0.639,0-1.278-0.243-1.768-0.731 L5.914,15.362l14.629-14.63c0.977-0.977,2.559-0.976,3.535,0c0.977,0.977,0.977,2.56,0,3.536L12.984,15.362L24.078,26.457z"),C.appendChild(E),v.appendChild(f),v.appendChild(A),v.appendChild(C),_.appendChild(v),w.appendChild(_),a.appendChild(w)}return a}}